const e="@components/";function t(){const e={imports:{}};return document.querySelectorAll('script[type="importmap"]').forEach(t=>{try{const o=JSON.parse(t.innerHTML);o.imports&&(e.imports=Object.assign(e.imports,o.imports))}catch(e){throw new Error("Failed to parse importmap JSON: "+e)}}),Object.keys(e.imports).length>0?e:null}function o(t){if(t.startsWith(e)){if(t.endsWith("/")){const e=t.slice(12,t.length-1),[o,n]=e.split("|",2);if(""===o)throw new Error("Invalid importmap key: "+t);return{key:t,prefix:o.replaceAll("/","-").toLowerCase(),loaderKey:n??null,isNameSpaced:!0}}{const e=t.slice(12),[o,n]=e.split("|",2),[r,a]=(n??"").split(",",2);if(""===o)throw new Error("Invalid importmap key: "+t);return{key:t,tagName:o.replaceAll("/","-").toLowerCase(),loaderKey:r||null,extends:a||null,isNameSpaced:!1}}}return null}function n(e){const t={},n={};for(const[r,a]of Object.entries(e.imports)){const e=o(r);null!==e&&(e.isNameSpaced?t[e.prefix]=e:n[e.tagName]=e)}return{prefixMap:t,loadMap:n}}async function r(e){return(await import(e)).default}const a="*",l="vanilla",s={postfix:".js",loader:r},i={scanImportmap:!0,loaders:{[l]:s,[a]:l},observable:!0},c=new Set,d=new Set;function u(e){let t,o,n=e.tagName.toLowerCase();if(n.includes("-"))t=n,o=null;else{const r=e.getAttribute("is");if(null===r)throw new Error("Custom element without a dash or 'is' attribute found: "+n);if(!r.includes("-"))throw new Error("Custom element 'is' attribute without a dash found: "+n);t=r,o=n}return{name:t,extends:o}}function p(e,t){for(const[o,n]of Object.entries(t))if(e.startsWith(o+"-"))return n;return null}async function f(e,t,o){let n=e.querySelectorAll(":not(:defined)");const r=new Set;for(const e of n){const n=e.tagName;if(r.has(n))continue;r.add(n);const{name:l,extends:s}=u(e);if(c.has(l))continue;if(d.has(l))continue;let i,f=p(l,t);if(null===f)throw new Error("No matching namespace found for lazy loaded component: "+l);if(null===f.loaderKey||f.loaderKey===a||""===f.loaderKey?(i=o[a],"string"==typeof i&&(i=o[i])):i=o[f.loaderKey],"string"==typeof i)throw new Error("Loader redirection is not supported for eager loaded components: "+n);d.add(l);let m=l.slice(f.prefix.length+1);if(""===m)throw new Error("Invalid component name for lazy loaded component: "+l);const y=f.key+m+i.postfix;try{const e=await i.loader(y);null!==e&&(null===s?customElements.define(l,e):customElements.define(l,e,{extends:s}))}catch(e){c.has(l)||(console.error(`Failed to lazy load component '${l}':`,e),c.add(l))}finally{d.delete(l)}}}async function m(e,t){for(const[o,n]of Object.entries(e)){let e;if(null===n.loaderKey||n.loaderKey===a||""===n.loaderKey?(e=t[a],"string"==typeof e&&(e=t[e])):e=t[n.loaderKey],"string"==typeof e)throw new Error("Loader redirection is not supported for eager loaded components: "+o);try{const t=await e.loader(n.key);null!==t&&(null===n.extends?customElements.define(o,t):customElements.define(o,t,{extends:n.extends}))}catch(e){c.has(o)||(console.error(`Failed to eager load component '${o}':`,e),c.add(o))}}}async function y(){const e=t();if(null===e)return;const{prefixMap:o,loadMap:r}=n(e);document.addEventListener("DOMContentLoaded",async()=>{if(0===Object.keys(o).length)return;try{await f(document,o,i.loaders)}catch(e){throw new Error("Failed to lazy load components: "+e)}if(!i.observable)return;new MutationObserver(async()=>{try{await f(document,o,i.loaders)}catch(e){throw new Error("Failed to lazy load components: "+e)}}).observe(document.documentElement,{childList:!0,subtree:!0})});try{await m(r,i.loaders)}catch(e){throw new Error("Failed to eager load components: "+e)}}export{a as DEFAULT_KEY,l as VANILLA_KEY,s as VANILLA_LOADER,n as buildMap,i as config,m as eagerLoad,f as lazyLoad,r as load,t as loadImportmap,y as registerHandler};
//# sourceMappingURL=index.esm.min.js.map
