const e="@components/";function t(){const e={imports:{}};return document.querySelectorAll('script[type="importmap"]').forEach(t=>{try{const n=JSON.parse(t.innerHTML);n.imports&&(e.imports=Object.assign(e.imports,n.imports))}catch(e){throw new Error("Failed to parse importmap JSON: "+e)}}),Object.keys(e.imports).length>0?e:null}function n(t){if(t.startsWith(e)){if(t.endsWith("/")){const e=t.slice(12,t.length-1),[n,o]=e.split("|",2);if(""===n)throw new Error("Invalid importmap key: "+t);return{key:t,prefix:n.replaceAll("/","-").toLowerCase(),loaderKey:o??null,isNameSpaced:!0}}{const e=t.slice(12),[n,o]=e.split("|",2),[r,a]=(o??"").split(",",2);if(""===n)throw new Error("Invalid importmap key: "+t);return{key:t,tagName:n.replaceAll("/","-").toLowerCase(),loaderKey:r||null,extends:a||null,isNameSpaced:!1}}}return null}function o(e){const t={},o={};for(const[r,a]of Object.entries(e.imports)){const e=n(r);null!==e&&(e.isNameSpaced?t[e.prefix]=e:o[e.tagName]=e)}return{prefixMap:t,loadMap:o}}async function r(e){return(await import(e)).default}const a="*",l="vanilla",s={postfix:".js",loader:r},i={scanImportmap:!0,loaders:{[l]:s,[a]:l},observable:!0},c=new Set,d=new Set;function m(e){let t,n,o=e.tagName.toLowerCase();if(o.includes("-"))t=o,n=null;else{const r=e.getAttribute("is");if(null===r)throw new Error("Custom element without a dash or 'is' attribute found: "+o);if(!r.includes("-"))throw new Error("Custom element 'is' attribute without a dash found: "+o);t=r,n=o}return{name:t,extends:n}}function u(e,t){for(const[n,o]of Object.entries(t))if(e.startsWith(n+"-"))return o;return null}function f(e){const t=new Array,n=new Set;for(const o of e){const e=o.tagName;if(n.has(e))continue;n.add(e);const r=m(o);c.has(r.name)||(d.has(r.name)||t.push(r))}return t}async function p(e,t,n){let o=e.querySelectorAll(":not(:defined)"),r=f(Array.from(o));for(;r.length>0;){for(const e of r){let o,r=u(e.name,t);if(null===r)throw new Error("No matching namespace found for lazy loaded component: "+e.name);if(null===r.loaderKey||r.loaderKey===a||""===r.loaderKey?(o=n[a],"string"==typeof o&&(o=n[o])):o=n[r.loaderKey],"string"==typeof o)throw new Error("Loader redirection is not supported for lazy loaded components: "+e.name);d.add(e.name);let l=e.name.slice(r.prefix.length+1);if(""===l)throw new Error("Invalid component name for lazy loaded component: "+e.name);const s=r.key+l+o.postfix;try{const t=await o.loader(s);if(null===t)throw new Error("Loader returned null for component: "+e.name);null===e.extends?customElements.define(e.name,t):customElements.define(e.name,t,{extends:e.extends})}catch(t){console.error(`Failed to lazy load component '${e.name}':`,t),c.add(e.name)}finally{d.delete(e.name)}}o=e.querySelectorAll(":not(:defined)"),r=f(Array.from(o))}}async function y(e,t){for(const[n,o]of Object.entries(e)){let e;if(null===o.loaderKey||o.loaderKey===a||""===o.loaderKey?(e=t[a],"string"==typeof e&&(e=t[e])):e=t[o.loaderKey],"string"==typeof e)throw new Error("Loader redirection is not supported for eager loaded components: "+n);try{const t=await e.loader(o.key);null!==t&&(null===o.extends?customElements.define(n,t):customElements.define(n,t,{extends:o.extends}))}catch(e){c.has(n)||(console.error(`Failed to eager load component '${n}':`,e),c.add(n))}}}async function w(){const e=t();if(null===e)return;const{prefixMap:n,loadMap:r}=o(e);document.addEventListener("DOMContentLoaded",async()=>{if(0===Object.keys(n).length)return;try{await p(document,n,i.loaders)}catch(e){throw new Error("Failed to lazy load components: "+e)}if(!i.observable)return;new MutationObserver(async()=>{try{await p(document,n,i.loaders)}catch(e){throw new Error("Failed to lazy load components: "+e)}}).observe(document.documentElement,{childList:!0,subtree:!0})});try{await y(r,i.loaders)}catch(e){throw new Error("Failed to eager load components: "+e)}}export{a as DEFAULT_KEY,l as VANILLA_KEY,s as VANILLA_LOADER,o as buildMap,i as config,y as eagerLoad,p as lazyLoad,r as load,t as loadImportmap,w as registerHandler};
//# sourceMappingURL=index.esm.min.js.map
