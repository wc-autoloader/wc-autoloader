{"version":3,"file":"index.esm.js","sources":["../src/importmap.ts","../src/vanilla.ts","../src/config.ts","../src/autoload.ts","../src/handler.ts"],"sourcesContent":["import { IImportMap, IKeyInfo, ILoadMap, IPrefixMap } from \"./types.js\";\r\n\r\nconst COMPONENT_KEYWORD = \"@components/\";\r\n\r\nexport function loadImportmap(): IImportMap | null {\r\n  const importmap: IImportMap = { imports: {} };\r\n  document.querySelectorAll('script[type=\"importmap\"]').forEach((script) => {\r\n    try {\r\n      const json = JSON.parse(script.innerHTML);\r\n      if (json.imports) {\r\n        importmap.imports = Object.assign(importmap.imports, json.imports);\r\n      }\r\n    } catch (e) {\r\n      throw new Error(\"Failed to parse importmap JSON: \" + e);\r\n    }\r\n  });\r\n  return Object.keys(importmap.imports).length > 0\r\n    ? importmap\r\n    : null;\r\n}\r\n\r\nfunction getKeyInfoFromImportmapKey(key: string): IKeyInfo | null {\r\n  if (key.startsWith(COMPONENT_KEYWORD)) {\r\n    if (key.endsWith(\"/\")) {\r\n      const prefixWithLoader = key.slice(COMPONENT_KEYWORD.length, key.length - 1);\r\n      const [ prefix, loaderKey ] = prefixWithLoader.split(\"|\", 2);\r\n      if (prefix === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        prefix: prefix.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey ?? null,\r\n        isNameSpaced: true\r\n      };\r\n    } else {\r\n      const tagNamePart = key.slice(COMPONENT_KEYWORD.length);\r\n      const [ tagName, loaderKeyPart ] = tagNamePart.split(\"|\", 2);\r\n      const [ loaderKey, extendsText ] = (loaderKeyPart ?? \"\").split(\",\", 2);\r\n      if (tagName === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        tagName: tagName.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey || null,\r\n        extends: extendsText || null,\r\n        isNameSpaced: false\r\n      };\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function buildMap(importmap: IImportMap): {\r\n  prefixMap: IPrefixMap, loadMap: ILoadMap\r\n} {\r\n  const prefixMap: IPrefixMap = {};\r\n  const loadMap: ILoadMap = {};\r\n  for (const [key, _value] of Object.entries(importmap.imports)) {\r\n    const keyInfo = getKeyInfoFromImportmapKey(key);\r\n    if (keyInfo === null) {\r\n      continue;\r\n    }\r\n    if (keyInfo.isNameSpaced) {\r\n      prefixMap[keyInfo.prefix] = keyInfo;\r\n    } else {\r\n      loadMap[keyInfo.tagName] = keyInfo;\r\n    }\r\n  }\r\n  return { prefixMap, loadMap };\r\n}","\r\n\r\nexport async function load(path: string): Promise<CustomElementConstructor> {\r\n  const module = await import(path);\r\n  return module.default as CustomElementConstructor;\r\n}","\r\nimport { IConfig } from \"./types.js\"\r\nimport { load } from \"./vanilla.js\"\r\n\r\nexport const DEFAULT_KEY = \"*\";\r\n\r\nexport const VANILLA_KEY = \"vanilla\";\r\n\r\nexport const VANILLA_LOADER = {\r\n  postfix: \".js\",\r\n  loader: load\r\n}\r\n\r\nconst DEFAULT_CONFIG: IConfig = {\r\n  scanImportmap: true,\r\n  loaders: {\r\n    [VANILLA_KEY]: VANILLA_LOADER,\r\n    [DEFAULT_KEY]: VANILLA_KEY\r\n  },\r\n  observable: true\r\n}\r\n\r\nexport const config = DEFAULT_CONFIG;","import { DEFAULT_KEY } from \"./config.js\";\r\nimport { IEagerLoadInfo, ILoader, INameSpaceInfo, IPrefixMap, ITagInfo } from \"./types.js\";\r\n\r\nconst failedTags = new Set<string>();\r\nconst loadingTags = new Set<string>();\r\n\r\nconst EXTENDS_MAP = new Map<any, string>();\r\n\r\nif (typeof window !== \"undefined\") {\r\n  const map = [\r\n    [HTMLButtonElement, \"button\"],\r\n    [HTMLInputElement, \"input\"],\r\n    [HTMLAnchorElement, \"a\"],\r\n    [HTMLImageElement, \"img\"],\r\n    [HTMLDivElement, \"div\"],\r\n    [HTMLSpanElement, \"span\"],\r\n    [HTMLParagraphElement, \"p\"],\r\n    [HTMLUListElement, \"ul\"],\r\n    [HTMLOListElement, \"ol\"],\r\n    [HTMLLIElement, \"li\"],\r\n    [HTMLTableElement, \"table\"],\r\n    [HTMLFormElement, \"form\"],\r\n    [HTMLLabelElement, \"label\"],\r\n    [HTMLSelectElement, \"select\"],\r\n    [HTMLTextAreaElement, \"textarea\"],\r\n    [HTMLHeadingElement, \"h1\"],\r\n    [HTMLQuoteElement, \"blockquote\"],\r\n    [HTMLPreElement, \"pre\"],\r\n    [HTMLBRElement, \"br\"],\r\n    [HTMLHRElement, \"hr\"],\r\n    [HTMLModElement, \"ins\"],\r\n    [HTMLTableCaptionElement, \"caption\"],\r\n    [HTMLTableColElement, \"col\"],\r\n    [HTMLTableSectionElement, \"tbody\"],\r\n    [HTMLTableRowElement, \"tr\"],\r\n    [HTMLTableCellElement, \"td\"],\r\n    [HTMLFieldSetElement, \"fieldset\"],\r\n    [HTMLLegendElement, \"legend\"],\r\n    [HTMLDListElement, \"dl\"],\r\n    [HTMLOptGroupElement, \"optgroup\"],\r\n    [HTMLOptionElement, \"option\"],\r\n    [HTMLStyleElement, \"style\"],\r\n    [HTMLScriptElement, \"script\"],\r\n    [HTMLTemplateElement, \"template\"],\r\n    [HTMLCanvasElement, \"canvas\"],\r\n    [HTMLIFrameElement, \"iframe\"],\r\n    [HTMLObjectElement, \"object\"],\r\n    [HTMLEmbedElement, \"embed\"],\r\n    [HTMLVideoElement, \"video\"],\r\n    [HTMLAudioElement, \"audio\"],\r\n    [HTMLTrackElement, \"track\"],\r\n    [HTMLMapElement, \"map\"],\r\n    [HTMLAreaElement, \"area\"],\r\n    [HTMLSourceElement, \"source\"],\r\n    [HTMLParamElement, \"param\"],\r\n    [HTMLMeterElement, \"meter\"],\r\n    [HTMLProgressElement, \"progress\"],\r\n    [HTMLOutputElement, \"output\"],\r\n    [HTMLDetailsElement, \"details\"],\r\n    [HTMLDialogElement, \"dialog\"],\r\n    [HTMLMenuElement, \"menu\"],\r\n    [HTMLSlotElement, \"slot\"],\r\n    [HTMLTimeElement, \"time\"],\r\n    [HTMLDataElement, \"data\"],\r\n    [HTMLPictureElement, \"picture\"],\r\n  ] as const;\r\n\r\n  map.forEach(([cls, tag]) => {\r\n    if (typeof cls !== \"undefined\") {\r\n      EXTENDS_MAP.set(cls, tag);\r\n    }\r\n  });\r\n}\r\n\r\nexport function resetState() {\r\n  failedTags.clear();\r\n  loadingTags.clear();\r\n}\r\n\r\nfunction getTagInfoFromElement(e: Element): ITagInfo {\r\n  const elementTagName = e.tagName.toLowerCase();\r\n  let name;\r\n  let extendsName;\r\n  if (elementTagName.includes(\"-\")) {\r\n    name = elementTagName;\r\n    extendsName = null;\r\n  } else {\r\n    const tagName = e.getAttribute(\"is\");\r\n    if (tagName === null) {\r\n      throw new Error(\"Custom element without a dash or 'is' attribute found: \" + elementTagName);\r\n    }\r\n    if (!tagName.includes(\"-\")) {\r\n      throw new Error(\"Custom element 'is' attribute without a dash found: \" + elementTagName);\r\n    }\r\n    name = tagName;\r\n    extendsName = elementTagName;\r\n  }\r\n  return { name, extends: extendsName };\r\n}\r\n\r\nfunction matchNameSpace(tagName: string, prefixMap: IPrefixMap): INameSpaceInfo | null {\r\n  for (const [prefix, info] of Object.entries(prefixMap)) {\r\n    if (tagName.startsWith(prefix + \"-\")) {\r\n      return info;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction getUndefinedTagInfos(elements:Array<Element>): Array<ITagInfo> {\r\n  const tagInfos = new Array<ITagInfo>();\r\n  const duplicateChecks = new Set<string>();\r\n  for(const element of elements) {\r\n    const tagName = element.tagName;\r\n    if (duplicateChecks.has(tagName)) {\r\n      continue;\r\n    }\r\n    duplicateChecks.add(tagName);\r\n    const tagInfo = getTagInfoFromElement(element);\r\n    if (failedTags.has(tagInfo.name)) {\r\n      continue;\r\n    }\r\n    if (loadingTags.has(tagInfo.name)) {\r\n      continue;\r\n    }\r\n    tagInfos.push(tagInfo);\r\n  }\r\n  return tagInfos;\r\n}\r\n\r\nfunction resolveLoader(\r\n  path: string,\r\n  loaderKey: string | null,\r\n  loaders: Record<string, ILoader | string>\r\n): ILoader {\r\n  let loader: ILoader | string;\r\n\r\n  if (loaderKey === null || loaderKey === DEFAULT_KEY || loaderKey === \"\") {\r\n    // Try to resolve by postfix\r\n    let resolvedLoader: ILoader | null = null;\r\n    \r\n    const candidates: ILoader[] = [];\r\n    for (const [key, l] of Object.entries(loaders)) {\r\n      if (key === DEFAULT_KEY) continue;\r\n      const currentLoader = typeof l === \"string\" ? loaders[l] : l;\r\n      if (typeof currentLoader === \"string\") continue; // Should not happen if config is correct\r\n      candidates.push(currentLoader);\r\n    }\r\n\r\n    // Sort by postfix length descending to match longest extension first\r\n    candidates.sort((a, b) => b.postfix.length - a.postfix.length);\r\n\r\n    for (const currentLoader of candidates) {\r\n      if (path.endsWith(currentLoader.postfix)) {\r\n        resolvedLoader = currentLoader;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (resolvedLoader) {\r\n      loader = resolvedLoader;\r\n    } else {\r\n      loader = loaders[DEFAULT_KEY];\r\n      if (typeof loader === \"string\") {\r\n        loader = loaders[loader];\r\n      }\r\n    }\r\n  } else {\r\n    loader = loaders[loaderKey];\r\n  }\r\n\r\n  if (typeof loader === \"string\") {\r\n    throw new Error(\"Loader redirection is not supported here\");\r\n  }\r\n  return loader;\r\n}\r\n\r\nfunction resolveExtends(componentConstructor: CustomElementConstructor): string | null {\r\n  for (const [cls, tag] of EXTENDS_MAP) {\r\n    if (componentConstructor.prototype instanceof cls) {\r\n      return tag;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport async function lazyLoad(\r\n  root: Document | ShadowRoot, \r\n  prefixMap: IPrefixMap,\r\n  loaders: Record<string, ILoader | string>\r\n): Promise<void> {\r\n  let elements = root.querySelectorAll(':not(:defined)');\r\n  let undefinedTagInfos = getUndefinedTagInfos(Array.from(elements));\r\n  while(undefinedTagInfos.length > 0) {\r\n    for(const tagInfo of undefinedTagInfos) {\r\n      const info: INameSpaceInfo | null = matchNameSpace(tagInfo.name, prefixMap);\r\n      if (info === null) {\r\n        throw new Error(\"No matching namespace found for lazy loaded component: \" + tagInfo.name);\r\n      }\r\n      \r\n      let loader: ILoader;\r\n      try {\r\n        loader = resolveLoader(\"\", info.loaderKey, loaders);\r\n      } catch (_e) {\r\n        throw new Error(\"Loader redirection is not supported for lazy loaded components: \" + tagInfo.name);\r\n      }\r\n\r\n      loadingTags.add(tagInfo.name);\r\n      const file: string = tagInfo.name.slice(info.prefix.length + 1);\r\n      if (file === \"\") {\r\n        throw new Error(\"Invalid component name for lazy loaded component: \" + tagInfo.name);\r\n      }\r\n      const path = info.key + file + loader.postfix;\r\n      try {\r\n        const componentConstructor = await loader.loader(path);\r\n        if (componentConstructor !== null) {\r\n          if (tagInfo.extends === null) {\r\n            customElements.define(tagInfo.name, componentConstructor);\r\n          } else {\r\n            customElements.define(tagInfo.name, componentConstructor, { extends: tagInfo.extends });\r\n          }\r\n        } else {\r\n          throw new Error(\"Loader returned null for component: \" + tagInfo.name);\r\n        }\r\n      } catch(e) {\r\n        console.error(`Failed to lazy load component '${tagInfo.name}':`, e);\r\n        failedTags.add(tagInfo.name);\r\n      } finally {\r\n        loadingTags.delete(tagInfo.name);\r\n      }\r\n\r\n    }\r\n    elements = root.querySelectorAll(':not(:defined)');\r\n    undefinedTagInfos = getUndefinedTagInfos(Array.from(elements));\r\n  }\r\n}\r\n\r\nexport async function eagerLoad(\r\n  loadMap: Record<string, IEagerLoadInfo>, \r\n  loaders: Record<string, ILoader | string>\r\n): Promise<void> {\r\n  for(const [tagName, info] of Object.entries(loadMap)) {\r\n    let loader: ILoader;\r\n    try {\r\n      loader = resolveLoader(info.key, info.loaderKey, loaders);\r\n    } catch (_e) {\r\n      throw new Error(\"Loader redirection is not supported for eager loaded components: \" + tagName);\r\n    }\r\n\r\n    try {\r\n      const componentConstructor = await loader.loader(info.key);\r\n      if (componentConstructor !== null) {\r\n        let extendsName = info.extends;\r\n        if (extendsName === null) {\r\n          extendsName = resolveExtends(componentConstructor);\r\n        }\r\n\r\n        if (extendsName === null) {\r\n          customElements.define(tagName, componentConstructor);\r\n        } else {\r\n          customElements.define(tagName, componentConstructor, { extends: extendsName });\r\n        }\r\n      }\r\n    } catch(e) {\r\n      if (!failedTags.has(tagName)) {\r\n        console.error(`Failed to eager load component '${tagName}':`, e);\r\n        failedTags.add(tagName);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { buildMap, loadImportmap } from \"./importmap.js\";\r\nimport { config } from \"./config.js\";\r\nimport { eagerLoad, lazyLoad } from \"./autoload.js\";\r\n\r\nexport async function registerHandler(): Promise<void> {\r\n  const importmap = loadImportmap(); // 事前に importmap を読み込んでおく\r\n  if (importmap === null) {\r\n    return;\r\n  }\r\n  const { prefixMap, loadMap } = buildMap(importmap);\r\n  // 先にeager loadを実行すると、DOMContentLoadedイベントが発生しないことがあるため、後に実行する\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", async (): Promise<void> => {\r\n    if (Object.keys(prefixMap).length === 0) {\r\n      return;\r\n    }\r\n    try {\r\n      await lazyLoad(document, prefixMap, config.loaders);\r\n    } catch(e) {\r\n      throw new Error(\"Failed to lazy load components: \" + e);\r\n    }\r\n\r\n    if (!config.observable) {\r\n      return;\r\n    }\r\n    const mo = new MutationObserver(async (): Promise<void> => {\r\n      try {\r\n        await lazyLoad(document, prefixMap, config.loaders);\r\n      } catch(e) {\r\n        throw new Error(\"Failed to lazy load components: \" + e);\r\n      }\r\n    });\r\n    mo.observe(document.documentElement, { childList: true, subtree: true });\r\n  });\r\n\r\n  try {\r\n    await eagerLoad(loadMap, config.loaders);\r\n  } catch(e) {\r\n    throw new Error(\"Failed to eager load components: \" + e);\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}