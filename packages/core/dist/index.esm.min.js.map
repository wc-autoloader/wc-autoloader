{"version":3,"file":"index.esm.min.js","sources":["../src/importmap.ts","../src/vanilla.ts","../src/config.ts","../src/autoload.ts","../src/handler.ts"],"sourcesContent":["import { IImportMap, IKeyInfo, ILoadMap, IPrefixMap } from \"./types.js\";\r\n\r\nconst COMPONENT_KEYWORD = \"@components/\";\r\n\r\nexport function loadImportmap(): IImportMap | null {\r\n  const importmap: IImportMap = { imports: {} };\r\n  document.querySelectorAll('script[type=\"importmap\"]').forEach((script) => {\r\n    try {\r\n      const json = JSON.parse(script.innerHTML);\r\n      if (json.imports) {\r\n        importmap.imports = Object.assign(importmap.imports, json.imports);\r\n      }\r\n    } catch (e) {\r\n      throw new Error(\"Failed to parse importmap JSON: \" + e);\r\n    }\r\n  });\r\n  return Object.keys(importmap.imports).length > 0\r\n    ? importmap\r\n    : null;\r\n}\r\n\r\nfunction getKeyInfoFromImportmapKey(key: string): IKeyInfo | null {\r\n  if (key.startsWith(COMPONENT_KEYWORD)) {\r\n    if (key.endsWith(\"/\")) {\r\n      const prefixWithLoader = key.slice(COMPONENT_KEYWORD.length, key.length - 1);\r\n      const [ prefix, loaderKey ] = prefixWithLoader.split(\"|\", 2);\r\n      if (prefix === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        prefix: prefix.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey ?? null,\r\n        isNameSpaced: true\r\n      };\r\n    } else {\r\n      const tagNamePart = key.slice(COMPONENT_KEYWORD.length);\r\n      const [ tagName, loaderKeyPart ] = tagNamePart.split(\"|\", 2);\r\n      const [ loaderKey, extendsText ] = (loaderKeyPart ?? \"\").split(\",\", 2);\r\n      if (tagName === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        tagName: tagName.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey || null,\r\n        extends: extendsText || null,\r\n        isNameSpaced: false\r\n      };\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function buildMap(importmap: IImportMap): {\r\n  prefixMap: IPrefixMap, loadMap: ILoadMap\r\n} {\r\n  const prefixMap: IPrefixMap = {};\r\n  const loadMap: ILoadMap = {};\r\n  for (const [key, _value] of Object.entries(importmap.imports)) {\r\n    const keyInfo = getKeyInfoFromImportmapKey(key);\r\n    if (keyInfo === null) {\r\n      continue;\r\n    }\r\n    if (keyInfo.isNameSpaced) {\r\n      prefixMap[keyInfo.prefix] = keyInfo;\r\n    } else {\r\n      loadMap[keyInfo.tagName] = keyInfo;\r\n    }\r\n  }\r\n  return { prefixMap, loadMap };\r\n}","\r\n\r\nexport async function load(path: string): Promise<CustomElementConstructor> {\r\n  const module = await import(path);\r\n  return module.default as CustomElementConstructor;\r\n}","\r\nimport { IConfig } from \"./types.js\"\r\nimport { load } from \"./vanilla.js\"\r\n\r\nexport const DEFAULT_KEY = \"*\";\r\n\r\nexport const VANILLA_KEY = \"vanilla\";\r\n\r\nexport const VANILLA_LOADER = {\r\n  postfix: \".js\",\r\n  loader: load\r\n}\r\n\r\nconst DEFAULT_CONFIG: IConfig = {\r\n  scanImportmap: true,\r\n  loaders: {\r\n    [VANILLA_KEY]: VANILLA_LOADER,\r\n    [DEFAULT_KEY]: VANILLA_KEY\r\n  },\r\n  observable: true\r\n}\r\n\r\nexport const config = DEFAULT_CONFIG;","import { DEFAULT_KEY } from \"./config.js\";\r\nimport { IEagerLoadInfo, ILoader, INameSpaceInfo, IPrefixMap, ITagInfo } from \"./types.js\";\r\n\r\nconst failedTags = new Set<string>();\r\nconst loadingTags = new Set<string>();\r\n\r\nconst EXTENDS_MAP = new Map<any, string>();\r\n\r\nif (typeof window !== \"undefined\") {\r\n  const map = [\r\n    [HTMLButtonElement, \"button\"],\r\n    [HTMLInputElement, \"input\"],\r\n    [HTMLAnchorElement, \"a\"],\r\n    [HTMLImageElement, \"img\"],\r\n    [HTMLDivElement, \"div\"],\r\n    [HTMLSpanElement, \"span\"],\r\n    [HTMLParagraphElement, \"p\"],\r\n    [HTMLUListElement, \"ul\"],\r\n    [HTMLOListElement, \"ol\"],\r\n    [HTMLLIElement, \"li\"],\r\n    [HTMLTableElement, \"table\"],\r\n    [HTMLFormElement, \"form\"],\r\n    [HTMLLabelElement, \"label\"],\r\n    [HTMLSelectElement, \"select\"],\r\n    [HTMLTextAreaElement, \"textarea\"],\r\n    [HTMLHeadingElement, \"h1\"],\r\n    [HTMLQuoteElement, \"blockquote\"],\r\n    [HTMLPreElement, \"pre\"],\r\n    [HTMLBRElement, \"br\"],\r\n    [HTMLHRElement, \"hr\"],\r\n    [HTMLModElement, \"ins\"],\r\n    [HTMLTableCaptionElement, \"caption\"],\r\n    [HTMLTableColElement, \"col\"],\r\n    [HTMLTableSectionElement, \"tbody\"],\r\n    [HTMLTableRowElement, \"tr\"],\r\n    [HTMLTableCellElement, \"td\"],\r\n    [HTMLFieldSetElement, \"fieldset\"],\r\n    [HTMLLegendElement, \"legend\"],\r\n    [HTMLDListElement, \"dl\"],\r\n    [HTMLOptGroupElement, \"optgroup\"],\r\n    [HTMLOptionElement, \"option\"],\r\n    [HTMLStyleElement, \"style\"],\r\n    [HTMLScriptElement, \"script\"],\r\n    [HTMLTemplateElement, \"template\"],\r\n    [HTMLCanvasElement, \"canvas\"],\r\n    [HTMLIFrameElement, \"iframe\"],\r\n    [HTMLObjectElement, \"object\"],\r\n    [HTMLEmbedElement, \"embed\"],\r\n    [HTMLVideoElement, \"video\"],\r\n    [HTMLAudioElement, \"audio\"],\r\n    [HTMLTrackElement, \"track\"],\r\n    [HTMLMapElement, \"map\"],\r\n    [HTMLAreaElement, \"area\"],\r\n    [HTMLSourceElement, \"source\"],\r\n    [HTMLParamElement, \"param\"],\r\n    [HTMLMeterElement, \"meter\"],\r\n    [HTMLProgressElement, \"progress\"],\r\n    [HTMLOutputElement, \"output\"],\r\n    [HTMLDetailsElement, \"details\"],\r\n    [HTMLDialogElement, \"dialog\"],\r\n    [HTMLMenuElement, \"menu\"],\r\n    [HTMLSlotElement, \"slot\"],\r\n    [HTMLTimeElement, \"time\"],\r\n    [HTMLDataElement, \"data\"],\r\n    [HTMLPictureElement, \"picture\"],\r\n  ] as const;\r\n\r\n  map.forEach(([cls, tag]) => {\r\n    if (typeof cls !== \"undefined\") {\r\n      EXTENDS_MAP.set(cls, tag);\r\n    }\r\n  });\r\n}\r\n\r\nexport function resetState() {\r\n  failedTags.clear();\r\n  loadingTags.clear();\r\n}\r\n\r\nfunction getTagInfoFromElement(e: Element): ITagInfo {\r\n  const elementTagName = e.tagName.toLowerCase();\r\n  let name;\r\n  let extendsName;\r\n  if (elementTagName.includes(\"-\")) {\r\n    name = elementTagName;\r\n    extendsName = null;\r\n  } else {\r\n    const tagName = e.getAttribute(\"is\");\r\n    if (tagName === null) {\r\n      throw new Error(\"Custom element without a dash or 'is' attribute found: \" + elementTagName);\r\n    }\r\n    if (!tagName.includes(\"-\")) {\r\n      throw new Error(\"Custom element 'is' attribute without a dash found: \" + elementTagName);\r\n    }\r\n    name = tagName;\r\n    extendsName = elementTagName;\r\n  }\r\n  return { name, extends: extendsName };\r\n}\r\n\r\nfunction matchNameSpace(tagName: string, prefixMap: IPrefixMap): INameSpaceInfo | null {\r\n  for (const [prefix, info] of Object.entries(prefixMap)) {\r\n    if (tagName.startsWith(prefix + \"-\")) {\r\n      return info;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction getUndefinedTagInfos(elements:Array<Element>): Array<ITagInfo> {\r\n  const tagInfos = new Array<ITagInfo>();\r\n  const duplicateChecks = new Set<string>();\r\n  for(const element of elements) {\r\n    const tagName = element.tagName;\r\n    if (duplicateChecks.has(tagName)) {\r\n      continue;\r\n    }\r\n    duplicateChecks.add(tagName);\r\n    const tagInfo = getTagInfoFromElement(element);\r\n    if (failedTags.has(tagInfo.name)) {\r\n      continue;\r\n    }\r\n    if (loadingTags.has(tagInfo.name)) {\r\n      continue;\r\n    }\r\n    tagInfos.push(tagInfo);\r\n  }\r\n  return tagInfos;\r\n}\r\n\r\nfunction resolveLoader(\r\n  path: string,\r\n  loaderKey: string | null,\r\n  loaders: Record<string, ILoader | string>\r\n): ILoader {\r\n  let loader: ILoader | string;\r\n\r\n  if (loaderKey === null || loaderKey === DEFAULT_KEY || loaderKey === \"\") {\r\n    // Try to resolve by postfix\r\n    let resolvedLoader: ILoader | null = null;\r\n    \r\n    const candidates: ILoader[] = [];\r\n    for (const [key, l] of Object.entries(loaders)) {\r\n      if (key === DEFAULT_KEY) continue;\r\n      const currentLoader = typeof l === \"string\" ? loaders[l] : l;\r\n      if (typeof currentLoader === \"string\") continue; // Should not happen if config is correct\r\n      candidates.push(currentLoader);\r\n    }\r\n\r\n    // Sort by postfix length descending to match longest extension first\r\n    candidates.sort((a, b) => b.postfix.length - a.postfix.length);\r\n\r\n    for (const currentLoader of candidates) {\r\n      if (path.endsWith(currentLoader.postfix)) {\r\n        resolvedLoader = currentLoader;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (resolvedLoader) {\r\n      loader = resolvedLoader;\r\n    } else {\r\n      loader = loaders[DEFAULT_KEY];\r\n      if (typeof loader === \"string\") {\r\n        loader = loaders[loader];\r\n      }\r\n    }\r\n  } else {\r\n    loader = loaders[loaderKey];\r\n  }\r\n\r\n  if (typeof loader === \"string\") {\r\n    throw new Error(\"Loader redirection is not supported here\");\r\n  }\r\n  return loader;\r\n}\r\n\r\nfunction resolveExtends(componentConstructor: CustomElementConstructor): string | null {\r\n  for (const [cls, tag] of EXTENDS_MAP) {\r\n    if (componentConstructor.prototype instanceof cls) {\r\n      return tag;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport async function lazyLoad(\r\n  root: Document | ShadowRoot, \r\n  prefixMap: IPrefixMap,\r\n  loaders: Record<string, ILoader | string>\r\n): Promise<void> {\r\n  let elements = root.querySelectorAll(':not(:defined)');\r\n  let undefinedTagInfos = getUndefinedTagInfos(Array.from(elements));\r\n  while(undefinedTagInfos.length > 0) {\r\n    for(const tagInfo of undefinedTagInfos) {\r\n      const info: INameSpaceInfo | null = matchNameSpace(tagInfo.name, prefixMap);\r\n      if (info === null) {\r\n        throw new Error(\"No matching namespace found for lazy loaded component: \" + tagInfo.name);\r\n      }\r\n      \r\n      let loader: ILoader;\r\n      try {\r\n        loader = resolveLoader(\"\", info.loaderKey, loaders);\r\n      } catch (_e) {\r\n        throw new Error(\"Loader redirection is not supported for lazy loaded components: \" + tagInfo.name);\r\n      }\r\n\r\n      loadingTags.add(tagInfo.name);\r\n      const file: string = tagInfo.name.slice(info.prefix.length + 1);\r\n      if (file === \"\") {\r\n        throw new Error(\"Invalid component name for lazy loaded component: \" + tagInfo.name);\r\n      }\r\n      const path = info.key + file + loader.postfix;\r\n      try {\r\n        const componentConstructor = await loader.loader(path);\r\n        if (componentConstructor !== null) {\r\n          if (tagInfo.extends === null) {\r\n            customElements.define(tagInfo.name, componentConstructor);\r\n          } else {\r\n            customElements.define(tagInfo.name, componentConstructor, { extends: tagInfo.extends });\r\n          }\r\n        } else {\r\n          throw new Error(\"Loader returned null for component: \" + tagInfo.name);\r\n        }\r\n      } catch(e) {\r\n        console.error(`Failed to lazy load component '${tagInfo.name}':`, e);\r\n        failedTags.add(tagInfo.name);\r\n      } finally {\r\n        loadingTags.delete(tagInfo.name);\r\n      }\r\n\r\n    }\r\n    elements = root.querySelectorAll(':not(:defined)');\r\n    undefinedTagInfos = getUndefinedTagInfos(Array.from(elements));\r\n  }\r\n}\r\n\r\nexport async function eagerLoad(\r\n  loadMap: Record<string, IEagerLoadInfo>, \r\n  loaders: Record<string, ILoader | string>\r\n): Promise<void> {\r\n  for(const [tagName, info] of Object.entries(loadMap)) {\r\n    let loader: ILoader;\r\n    try {\r\n      loader = resolveLoader(info.key, info.loaderKey, loaders);\r\n    } catch (_e) {\r\n      throw new Error(\"Loader redirection is not supported for eager loaded components: \" + tagName);\r\n    }\r\n\r\n    try {\r\n      const componentConstructor = await loader.loader(info.key);\r\n      if (componentConstructor !== null) {\r\n        let extendsName = info.extends;\r\n        if (extendsName === null) {\r\n          extendsName = resolveExtends(componentConstructor);\r\n        }\r\n\r\n        if (extendsName === null) {\r\n          customElements.define(tagName, componentConstructor);\r\n        } else {\r\n          customElements.define(tagName, componentConstructor, { extends: extendsName });\r\n        }\r\n      }\r\n    } catch(e) {\r\n      if (!failedTags.has(tagName)) {\r\n        console.error(`Failed to eager load component '${tagName}':`, e);\r\n        failedTags.add(tagName);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { buildMap, loadImportmap } from \"./importmap.js\";\r\nimport { config } from \"./config.js\";\r\nimport { eagerLoad, lazyLoad } from \"./autoload.js\";\r\n\r\nexport async function registerHandler(): Promise<void> {\r\n  const importmap = loadImportmap(); // 事前に importmap を読み込んでおく\r\n  if (importmap === null) {\r\n    return;\r\n  }\r\n  const { prefixMap, loadMap } = buildMap(importmap);\r\n  // 先にeager loadを実行すると、DOMContentLoadedイベントが発生しないことがあるため、後に実行する\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", async (): Promise<void> => {\r\n    if (Object.keys(prefixMap).length === 0) {\r\n      return;\r\n    }\r\n    try {\r\n      await lazyLoad(document, prefixMap, config.loaders);\r\n    } catch(e) {\r\n      throw new Error(\"Failed to lazy load components: \" + e);\r\n    }\r\n\r\n    if (!config.observable) {\r\n      return;\r\n    }\r\n    const mo = new MutationObserver(async (): Promise<void> => {\r\n      try {\r\n        await lazyLoad(document, prefixMap, config.loaders);\r\n      } catch(e) {\r\n        throw new Error(\"Failed to lazy load components: \" + e);\r\n      }\r\n    });\r\n    mo.observe(document.documentElement, { childList: true, subtree: true });\r\n  });\r\n\r\n  try {\r\n    await eagerLoad(loadMap, config.loaders);\r\n  } catch(e) {\r\n    throw new Error(\"Failed to eager load components: \" + e);\r\n  }\r\n}\r\n\r\n"],"names":["COMPONENT_KEYWORD","loadImportmap","importmap","imports","document","querySelectorAll","forEach","script","json","JSON","parse","innerHTML","Object","assign","e","Error","keys","length","getKeyInfoFromImportmapKey","key","startsWith","endsWith","prefixWithLoader","slice","prefix","loaderKey","split","replaceAll","toLowerCase","isNameSpaced","tagNamePart","tagName","loaderKeyPart","extendsText","extends","buildMap","prefixMap","loadMap","_value","entries","keyInfo","async","load","path","import","default","DEFAULT_KEY","VANILLA_KEY","VANILLA_LOADER","postfix","loader","config","scanImportmap","loaders","observable","failedTags","Set","loadingTags","EXTENDS_MAP","Map","window","HTMLButtonElement","HTMLInputElement","HTMLAnchorElement","HTMLImageElement","HTMLDivElement","HTMLSpanElement","HTMLParagraphElement","HTMLUListElement","HTMLOListElement","HTMLLIElement","HTMLTableElement","HTMLFormElement","HTMLLabelElement","HTMLSelectElement","HTMLTextAreaElement","HTMLHeadingElement","HTMLQuoteElement","HTMLPreElement","HTMLBRElement","HTMLHRElement","HTMLModElement","HTMLTableCaptionElement","HTMLTableColElement","HTMLTableSectionElement","HTMLTableRowElement","HTMLTableCellElement","HTMLFieldSetElement","HTMLLegendElement","HTMLDListElement","HTMLOptGroupElement","HTMLOptionElement","HTMLStyleElement","HTMLScriptElement","HTMLTemplateElement","HTMLCanvasElement","HTMLIFrameElement","HTMLObjectElement","HTMLEmbedElement","HTMLVideoElement","HTMLAudioElement","HTMLTrackElement","HTMLMapElement","HTMLAreaElement","HTMLSourceElement","HTMLParamElement","HTMLMeterElement","HTMLProgressElement","HTMLOutputElement","HTMLDetailsElement","HTMLDialogElement","HTMLMenuElement","HTMLSlotElement","HTMLTimeElement","HTMLDataElement","HTMLPictureElement","cls","tag","set","getTagInfoFromElement","elementTagName","name","extendsName","includes","getAttribute","matchNameSpace","info","getUndefinedTagInfos","elements","tagInfos","Array","duplicateChecks","element","has","add","tagInfo","push","resolveLoader","resolvedLoader","candidates","l","currentLoader","sort","a","b","resolveExtends","componentConstructor","prototype","lazyLoad","root","undefinedTagInfos","from","_e","file","customElements","define","console","error","delete","eagerLoad","registerHandler","addEventListener","MutationObserver","observe","documentElement","childList","subtree"],"mappings":"AAEA,MAAMA,EAAoB,wBAEVC,IACd,MAAMC,EAAwB,CAAEC,QAAS,IAWzC,OAVAC,SAASC,iBAAiB,4BAA4BC,QAASC,IAC7D,IACE,MAAMC,EAAOC,KAAKC,MAAMH,EAAOI,WAC3BH,EAAKL,UACPD,EAAUC,QAAUS,OAAOC,OAAOX,EAAUC,QAASK,EAAKL,SAE9D,CAAE,MAAOW,GACP,MAAM,IAAIC,MAAM,mCAAqCD,EACvD,IAEKF,OAAOI,KAAKd,EAAUC,SAASc,OAAS,EAC3Cf,EACA,IACN,CAEA,SAASgB,EAA2BC,GAClC,GAAIA,EAAIC,WAAWpB,GAAoB,CACrC,GAAImB,EAAIE,SAAS,KAAM,CACrB,MAAMC,EAAmBH,EAAII,MAAMvB,GAA0BmB,EAAIF,OAAS,IAClEO,EAAQC,GAAcH,EAAiBI,MAAM,IAAK,GAC1D,GAAe,KAAXF,EACF,MAAM,IAAIT,MAAM,0BAA4BI,GAE9C,MAAO,CACLA,MACAK,OAAQA,EAAOG,WAAW,IAAK,KAAKC,cACpCH,UAAWA,GAAa,KACxBI,cAAc,EAElB,CAAO,CACL,MAAMC,EAAcX,EAAII,MAAMvB,KACtB+B,EAASC,GAAkBF,EAAYJ,MAAM,IAAK,IAClDD,EAAWQ,IAAiBD,GAAiB,IAAIN,MAAM,IAAK,GACpE,GAAgB,KAAZK,EACF,MAAM,IAAIhB,MAAM,0BAA4BI,GAE9C,MAAO,CACLA,MACAY,QAASA,EAAQJ,WAAW,IAAK,KAAKC,cACtCH,UAAWA,GAAa,KACxBS,QAASD,GAAe,KACxBJ,cAAc,EAElB,CACF,CACA,OAAO,IACT,CAEM,SAAUM,EAASjC,GAGvB,MAAMkC,EAAwB,CAAA,EACxBC,EAAoB,CAAA,EAC1B,IAAK,MAAOlB,EAAKmB,KAAW1B,OAAO2B,QAAQrC,EAAUC,SAAU,CAC7D,MAAMqC,EAAUtB,EAA2BC,GAC3B,OAAZqB,IAGAA,EAAQX,aACVO,EAAUI,EAAQhB,QAAUgB,EAE5BH,EAAQG,EAAQT,SAAWS,EAE/B,CACA,MAAO,CAAEJ,YAAWC,UACtB,CCrEOI,eAAeC,EAAKC,GAEzB,aADqBC,OAAOD,IACdE,OAChB,CCDO,MAAMC,EAAc,IAEdC,EAAc,UAEdC,EAAiB,CAC5BC,QAAS,MACTC,OAAQR,GAYGS,EATmB,CAC9BC,eAAe,EACfC,QAAS,CACPN,CAACA,GAAcC,EACfF,CAACA,GAAcC,GAEjBO,YAAY,GChBRC,EAAa,IAAIC,IACjBC,EAAc,IAAID,IAElBE,EAAc,IAAIC,IAExB,GAAsB,oBAAXC,OAAwB,CACrB,CACV,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,kBAAmB,KACpB,CAACC,iBAAkB,OACnB,CAACC,eAAgB,OACjB,CAACC,gBAAiB,QAClB,CAACC,qBAAsB,KACvB,CAACC,iBAAkB,MACnB,CAACC,iBAAkB,MACnB,CAACC,cAAe,MAChB,CAACC,iBAAkB,SACnB,CAACC,gBAAiB,QAClB,CAACC,iBAAkB,SACnB,CAACC,kBAAmB,UACpB,CAACC,oBAAqB,YACtB,CAACC,mBAAoB,MACrB,CAACC,iBAAkB,cACnB,CAACC,eAAgB,OACjB,CAACC,cAAe,MAChB,CAACC,cAAe,MAChB,CAACC,eAAgB,OACjB,CAACC,wBAAyB,WAC1B,CAACC,oBAAqB,OACtB,CAACC,wBAAyB,SAC1B,CAACC,oBAAqB,MACtB,CAACC,qBAAsB,MACvB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,MACnB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,kBAAmB,UACpB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,kBAAmB,UACpB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,eAAgB,OACjB,CAACC,gBAAiB,QAClB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,mBAAoB,WACrB,CAACC,kBAAmB,UACpB,CAACC,gBAAiB,QAClB,CAACC,gBAAiB,QAClB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"}